sudo: required

services:
    - docker

env:
    global:
        - IMAGE_SERVICE_TAG: "registry.heroku.com/${HEROKU_USERNAME}-devops_exam/image-service"

before_install:
    - docker login --username "${HEROKU_USERNAME}" --password "${HEROKU_API_KEY}" registry.heroku.com
    - docker build -t "${IMAGE_SERVICE_TAG}" image-service

script:
    - docker images
    - docker push "${IMAGE_SERVICE_TAG}"


deploy:
#    - provider: script
#      skip-cleanup: true
#      script:
#          - docker push "${IMAGE_SERVICE_TAG}"
#      on:
#          branch: development 

    - provider: pages
      skip-cleanup: true
      github-token: "${GITHUB_TOKEN}"
      keep-history: true
      local-dir: viewer-service
      on:
          branch: development
